<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for js/arethusa.core/key_capture.js</title>
    <meta charset="utf-8">

    <link rel="stylesheet" href="../../prettify.css">

    <style>
        body, html {
            margin:0; padding: 0;
        }
        body {
            font-family: Helvetica Neue, Helvetica,Arial;
            font-size: 10pt;
        }
        div.header, div.footer {
            background: #eee;
            padding: 1em;
        }
        div.header {
            z-index: 100;
            position: fixed;
            top: 0;
            border-bottom: 1px solid #666;
            width: 100%;
        }
        div.footer {
            border-top: 1px solid #666;
        }
        div.body {
            margin-top: 10em;
        }
        div.meta {
            font-size: 90%;
            text-align: center;
        }
        h1, h2, h3 {
            font-weight: normal;
        }
        h1 {
            font-size: 12pt;
        }
        h2 {
            font-size: 10pt;
        }
        pre {
            font-family: Consolas, Menlo, Monaco, monospace;
            margin: 0;
            padding: 0;
            line-height: 14px;
            font-size: 14px;
            -moz-tab-size: 2;
            -o-tab-size:  2;
            tab-size: 2;
        }

        div.path { font-size: 110%; }
        div.path a:link, div.path a:visited { color: #000; }
        table.coverage { border-collapse: collapse; margin:0; padding: 0 }

        table.coverage td {
            margin: 0;
            padding: 0;
            color: #111;
            vertical-align: top;
        }
        table.coverage td.line-count {
            width: 50px;
            text-align: right;
            padding-right: 5px;
        }
        table.coverage td.line-coverage {
            color: #777 !important;
            text-align: right;
            border-left: 1px solid #666;
            border-right: 1px solid #666;
        }

        table.coverage td.text {
        }

        table.coverage td span.cline-any {
            display: inline-block;
            padding: 0 5px;
            width: 40px;
        }
        table.coverage td span.cline-neutral {
            background: #eee;
        }
        table.coverage td span.cline-yes {
            background: #b5d592;
            color: #999;
        }
        table.coverage td span.cline-no {
            background: #fc8c84;
        }

        .cstat-yes { color: #111; }
        .cstat-no { background: #fc8c84; color: #111; }
        .fstat-no { background: #ffc520; color: #111 !important; }
        .cbranch-no { background:  yellow !important; color: #111; }

        .cstat-skip { background: #ddd; color: #111; }
        .fstat-skip { background: #ddd; color: #111 !important; }
        .cbranch-skip { background: #ddd !important; color: #111; }

        .missing-if-branch {
            display: inline-block;
            margin-right: 10px;
            position: relative;
            padding: 0 4px;
            background: black;
            color: yellow;
        }

        .skip-if-branch {
            display: none;
            margin-right: 10px;
            position: relative;
            padding: 0 4px;
            background: #ccc;
            color: white;
        }

        .missing-if-branch .typ, .skip-if-branch .typ {
            color: inherit !important;
        }

        .entity, .metric { font-weight: bold; }
        .metric { display: inline-block; border: 1px solid #333; padding: 0.3em; background: white; }
        .metric small { font-size: 80%; font-weight: normal; color: #666; }

        div.coverage-summary table { border-collapse: collapse; margin: 3em; font-size: 110%; }
        div.coverage-summary td, div.coverage-summary table  th { margin: 0; padding: 0.25em 1em; border-top: 1px solid #666; border-bottom: 1px solid #666; }
        div.coverage-summary th { text-align: left; border: 1px solid #666; background: #eee; font-weight: normal; }
        div.coverage-summary th.file { border-right: none !important; }
        div.coverage-summary th.pic { border-left: none !important; text-align: right; }
        div.coverage-summary th.pct { border-right: none !important; }
        div.coverage-summary th.abs { border-left: none !important; text-align: right; }
        div.coverage-summary td.pct { text-align: right; border-left: 1px solid #666; }
        div.coverage-summary td.abs { text-align: right; font-size: 90%; color: #444; border-right: 1px solid #666; }
        div.coverage-summary td.file { text-align: right; border-left: 1px solid #666; white-space: nowrap;  }
        div.coverage-summary td.pic { min-width: 120px !important;  }
        div.coverage-summary a:link { text-decoration: none; color: #000; }
        div.coverage-summary a:visited { text-decoration: none; color: #333; }
        div.coverage-summary a:hover { text-decoration: underline; }
        div.coverage-summary tfoot td { border-top: 1px solid #666; }

        div.coverage-summary .yui3-datatable-sort-indicator, div.coverage-summary .dummy-sort-indicator {
            height: 10px;
            width: 7px;
            display: inline-block;
            margin-left: 0.5em;
        }
        div.coverage-summary .yui3-datatable-sort-indicator {
            background: url("https://yui-s.yahooapis.com/3.6.0/build/datatable-sort/assets/skins/sam/sort-arrow-sprite.png") no-repeat scroll 0 0 transparent;
        }
        div.coverage-summary .yui3-datatable-sorted .yui3-datatable-sort-indicator {
            background-position: 0 -20px;
        }
        div.coverage-summary .yui3-datatable-sorted-desc .yui3-datatable-sort-indicator {
            background-position: 0 -10px;
        }

        .high { background: #b5d592 !important; }
        .medium { background: #ffe87c !important; }
        .low { background: #fc8c84 !important; }

        span.cover-fill, span.cover-empty {
            display:inline-block;
            border:1px solid #444;
            background: white;
            height: 12px;
        }
        span.cover-fill {
            background: #ccc;
            border-right: 1px solid #444;
        }
        span.cover-empty {
            background: white;
            border-left: none;
        }
        span.cover-full {
            border-right: none !important;
        }
        pre.prettyprint {
            border: none !important;
            padding: 0 !important;
            margin: 0 !important;
        }
        .com { color: #999 !important; }
        .ignore-none { color: #999; font-weight: normal; }

    </style>
</head>
<body>
<div class="header medium">
    <h1>Code coverage report for <span class="entity">js/arethusa.core/key_capture.js</span></h1>
    <h2>
        
        Statements: <span class="metric">63.75% <small>(153 / 240)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        
        Branches: <span class="metric">43.18% <small>(38 / 88)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        
        Functions: <span class="metric">60.78% <small>(31 / 51)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        
        Lines: <span class="metric">65.04% <small>(147 / 226)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        Ignored: <span class="metric"><span class="ignore-none">none</span></span> &nbsp;&nbsp;&nbsp;&nbsp;
    </h2>
    <div class="path"><a href="../../index.html">All files</a> &#187; <a href="index.html">js/arethusa.core/</a> &#187; key_capture.js</div>
</div>
<div class="body">
<pre><table class="coverage">
<tr><td class="line-count">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412
413
414
415
416
417
418
419
420
421
422
423
424
425
426
427
428
429
430
431
432
433
434
435
436
437
438
439
440
441
442
443
444
445
446
447
448
449
450
451
452
453
454
455
456
457
458</td><td class="line-coverage"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">190</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">190</span>
<span class="cline-any cline-yes">339</span>
<span class="cline-any cline-yes">339</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">190</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">190</span>
<span class="cline-any cline-yes">4940</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">190</span>
<span class="cline-any cline-yes">8360</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">190</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">190</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">190</span>
<span class="cline-any cline-yes">190</span>
<span class="cline-any cline-yes">190</span>
<span class="cline-any cline-yes">190</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">190</span>
<span class="cline-any cline-yes">616</span>
<span class="cline-any cline-yes">616</span>
<span class="cline-any cline-yes">616</span>
<span class="cline-any cline-yes">616</span>
<span class="cline-any cline-yes">142</span>
<span class="cline-any cline-yes">142</span>
<span class="cline-any cline-yes">2</span>
<span class="cline-any cline-yes">140</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">142</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">616</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">616</span>
<span class="cline-any cline-yes">616</span>
<span class="cline-any cline-yes">616</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">139</span>
<span class="cline-any cline-yes">138</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">139</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">616</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">190</span>
<span class="cline-any cline-yes">190</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">190</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">13</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">13</span>
<span class="cline-any cline-yes">13</span>
<span class="cline-any cline-yes">13</span>
<span class="cline-any cline-yes">13</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">13</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">190</span>
<span class="cline-any cline-yes">13</span>
<span class="cline-any cline-yes">13</span>
<span class="cline-any cline-yes">13</span>
<span class="cline-any cline-yes">13</span>
<span class="cline-any cline-yes">13</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">7</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">190</span>
<span class="cline-any cline-yes">190</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">190</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">190</span>
<span class="cline-any cline-yes">20</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">20</span>
<span class="cline-any cline-yes">7</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">7</span>
<span class="cline-any cline-yes">7</span>
<span class="cline-any cline-yes">7</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">13</span>
<span class="cline-any cline-yes">13</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">190</span>
<span class="cline-any cline-yes">5</span>
<span class="cline-any cline-yes">5</span>
<span class="cline-any cline-yes">41</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">20</span>
<span class="cline-any cline-yes">20</span>
<span class="cline-any cline-yes">20</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">13</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">616</span>
<span class="cline-any cline-yes">616</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">190</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">616</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">190</span>
<span class="cline-any cline-yes">616</span>
<span class="cline-any cline-yes">616</span>
<span class="cline-any cline-yes">616</span>
<span class="cline-any cline-yes">616</span>
<span class="cline-any cline-yes">616</span>
<span class="cline-any cline-yes">616</span>
<span class="cline-any cline-yes">616</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">616</span>
<span class="cline-any cline-yes">4</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">190</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">190</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">13</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">13</span>
<span class="cline-any cline-yes">15</span>
<span class="cline-any cline-yes">15</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">603</span>
<span class="cline-any cline-yes">603</span>
<span class="cline-any cline-yes">603</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">190</span>
<span class="cline-any cline-yes">603</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">603</span>
<span class="cline-any cline-yes">603</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">330</span>
<span class="cline-any cline-yes">330</span>
<span class="cline-any cline-yes">330</span>
<span class="cline-any cline-yes">330</span>
<span class="cline-any cline-yes">603</span>
<span class="cline-any cline-yes">603</span>
<span class="cline-any cline-yes">603</span>
<span class="cline-any cline-yes">603</span>
<span class="cline-any cline-yes">603</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">330</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">660</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">190</span>
<span class="cline-any cline-yes">330</span>
<span class="cline-any cline-yes">330</span>
<span class="cline-any cline-yes">330</span>
<span class="cline-any cline-yes">330</span>
<span class="cline-any cline-yes">603</span>
<span class="cline-any cline-yes">603</span>
<span class="cline-any cline-yes">603</span>
<span class="cline-any cline-yes">603</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">603</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">330</span>
<span class="cline-any cline-yes">330</span>
<span class="cline-any cline-yes">330</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">330</span>
<span class="cline-any cline-yes">330</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">190</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">190</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">190</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">'use strict';
&nbsp;
/**
 * @ngdoc service
 * @name arethusa.core.keyCapture
 *
 * @description
 * Service to handle Arethusa's keyboard shortcuts.
 *
 * While its API is fairly clean and comfortable to use, the implementation
 * is of very poor quality and very hard to read.
 *
 *
 * @requires arethusa.core.configurator
 * @requires $rootScope
 */
angular.module('arethusa.core').service('keyCapture', [
  'configurator',
  '$rootScope',
  function(configurator, $rootScope) {
    var self = this;
&nbsp;
    this.conf = function(name) {
      var c = configurator.configurationFor('keyCapture') || <span class="branch-1 cbranch-no" title="branch not covered" >{};</span>
      return c[name] || {};
    };
&nbsp;
    var keyCodes = {
      return: 13,
      '↵': 13,
      shift: 16,
      ctrl: 17,
      alt: 18,
      esc: 27,
      up: 38,
      down: 40,
      left:  37,
      right: 39,
      '←': 37,
      '→': 39,
      '↑': 38,
      '↓': 40,
      ":" : 186,
      "[" : 219,
      "'" : 222,
      "]" : 221
    };
&nbsp;
    // a-z codes
    for (var i = 97; i &lt; 123; i++){
      keyCodes[String.fromCharCode(i)] = i - 32;
    }
&nbsp;
    var codesToKeys = arethusaUtil.inject({}, keyCodes, function(memo, key, code) {
      memo[code] = key;
    });
&nbsp;
    this.codeToKey = <span class="fstat-no" title="function not covered" >function(keyCode) {</span>
<span class="cstat-no" title="statement not covered" >      return codesToKeys[keyCode];</span>
    };
&nbsp;
    this.keyToCode = <span class="fstat-no" title="function not covered" >function(key) {</span>
<span class="cstat-no" title="statement not covered" >      return keyCodes[key];</span>
    };
&nbsp;
    this.shiftModifier = 1000;
    this.ctrlModifier  = 2000;
    this.altModifier   = 4000;
    this.metaModifier  = 8000;
&nbsp;
    this.getKeyCode = function(key) {
      var parsed = parseKey(key);
      var modifiers = parsed[0];
      var k = parsed[1];
      angular.forEach(modifiers, function(modifier, i) {
        var mod;
        switch (modifier) {
          case 'ctrl':  mod = self.ctrlModifier;  break;
          case 'shift': mod = self.shiftModifier; break;
<span class="branch-2 cbranch-no" title="branch not covered" >          case 'alt':   <span class="cstat-no" title="statement not covered" >mod = self.altModifier; </span>  <span class="cstat-no" title="statement not covered" >break;</span></span>
<span class="branch-3 cbranch-no" title="branch not covered" >          case 'meta':  <span class="cstat-no" title="statement not covered" >mod = self.metaModifier; </span>  <span class="cstat-no" title="statement not covered" >break;</span></span>
        }
        k = k + mod;
      });
&nbsp;
      return k;
    };
&nbsp;
    function parseKey(key) {
      var parts = key.split('-');
      var k = parts.pop();
      if (k.match(/[A-Z]/)) {
        // in case someone wants to do shift-J
        if (! arethusaUtil.isIncluded(parts, 'shift')) {
          parts.push('shift');
        }
        k = k.toLowerCase();
      }
&nbsp;
      return [parts, keyCodes[k]];
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function modifiers(keys) {</span>
<span class="cstat-no" title="statement not covered" >      return Object.keys(keys.modifiers);</span>
    }
&nbsp;
    var lookUpKey = [];
    this.getForeignKey = <span class="fstat-no" title="function not covered" >function(event, language) {</span>
&nbsp;
      // Disallow modifier keys except for shift
<span class="cstat-no" title="statement not covered" >      if (event.altKey || event.ctrlKey) {</span>
<span class="cstat-no" title="statement not covered" >        return undefined;</span>
      }
&nbsp;
<span class="cstat-no" title="statement not covered" >      var res = [];</span>
<span class="cstat-no" title="statement not covered" >      var keys = keysFor(language);</span>
<span class="cstat-no" title="statement not covered" >      var key = codesToKeys[event.keyCode];</span>
<span class="cstat-no" title="statement not covered" >      var mod = keys.modifiers;</span>
<span class="cstat-no" title="statement not covered" >      if (key) {</span>
        // We don't want to match 'shift' as a key, so
        // we return if it's the case.
<span class="cstat-no" title="statement not covered" >        if (key == 'shift') {</span>
<span class="cstat-no" title="statement not covered" >          return;</span>
        }
<span class="cstat-no" title="statement not covered" >        if (event.shiftKey) {</span>
<span class="cstat-no" title="statement not covered" >          res.push('shift');</span>
        }
<span class="cstat-no" title="statement not covered" >        if (arethusaUtil.isIncluded(modifiers(keys), key)) {</span>
<span class="cstat-no" title="statement not covered" >          res.push(key);</span>
<span class="cstat-no" title="statement not covered" >          var joined = res.join('-');</span>
<span class="cstat-no" title="statement not covered" >          lookUpKey.push(joined);</span>
<span class="cstat-no" title="statement not covered" >          return false;</span>
        } else {
<span class="cstat-no" title="statement not covered" >          if (arethusaUtil.isIncluded(res, 'shift')) {</span>
            // Following lines provide that 'shift-a'
            // and 'A' is the same.
<span class="cstat-no" title="statement not covered" >            var i = res.indexOf("shift");</span>
<span class="cstat-no" title="statement not covered" >            res.splice(i, 1);</span>
<span class="cstat-no" title="statement not covered" >            key = key.toUpperCase();</span>
          }
<span class="cstat-no" title="statement not covered" >          res.push(key);</span>
        }
      }
&nbsp;
<span class="cstat-no" title="statement not covered" >      var lookUp = lookUpKey.concat(res);</span>
<span class="cstat-no" title="statement not covered" >      var sortedLookUp = sortLookUp(lookUp, mod);</span>
<span class="cstat-no" title="statement not covered" >      var foreignKey = keys[sortedLookUp.join('-')];</span>
<span class="cstat-no" title="statement not covered" >      lookUpKey = [];</span>
<span class="cstat-no" title="statement not covered" >      return foreignKey;</span>
    };
&nbsp;
<span class="fstat-no" title="function not covered" >    function sortLookUp(lookUp, modifiers) {</span>
<span class="cstat-no" title="statement not covered" >      var lastItem = lookUp.length - 1;</span>
<span class="cstat-no" title="statement not covered" >      var letter = lookUp[lastItem];</span>
<span class="cstat-no" title="statement not covered" >      var mod = lookUp.slice(0, lastItem);</span>
<span class="cstat-no" title="statement not covered" >      mod.sort(<span class="fstat-no" title="function not covered" >function(a,b) {</span></span>
<span class="cstat-no" title="statement not covered" >        return modifiers[a]-modifiers[b];</span>
      });
<span class="cstat-no" title="statement not covered" >      return mod.concat(letter);</span>
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function keysFor(language) {</span>
<span class="cstat-no" title="statement not covered" >      var keys = (self.conf('keys') || {})[language];</span>
<span class="cstat-no" title="statement not covered" >      return keys || {};</span>
    }
&nbsp;
    var keyPressedCallbacks = {};
&nbsp;
    function modifiedKeyCode(event) {
      var k = event.keyCode;
&nbsp;
      if (event.shiftKey) k = k + self.shiftModifier;
      if (event.ctrlKey)  k = k + self.ctrlModifier;
      <span class="missing-if-branch" title="if path not taken" >I</span>if (event.altKey)   <span class="cstat-no" title="statement not covered" >k = k + self.altModifier;</span>
      <span class="missing-if-branch" title="if path not taken" >I</span>if (event.metaKey)  <span class="cstat-no" title="statement not covered" >k = k + self.metaModifier;</span>
&nbsp;
      return k;
    }
&nbsp;
    var handleCallbacks = function(event) {
      var keyCode = modifiedKeyCode(event);
      var callbacks = keyPressedCallbacks[keyCode];
      <span class="missing-if-branch" title="else path not taken" >E</span>if (callbacks) {
        resolveCallbacks(callbacks, event);
        resumePropagation();
      }
    };
&nbsp;
    function broadcastKey(key) {
      $rootScope.$broadcast('keyCaptureLaunched', keyList[key] || key);
    }
&nbsp;
    var forbiddenTags = ['INPUT', 'TEXTAREA', 'SELECT'];
    this.keydown = <span class="fstat-no" title="function not covered" >function (event) {</span>
<span class="cstat-no" title="statement not covered" >      if (arethusaUtil.isIncluded(forbiddenTags, event.target.tagName) ||</span>
          isRepeater(event.keyCode)) {
<span class="cstat-no" title="statement not covered" >        return;</span>
      }
&nbsp;
<span class="cstat-no" title="statement not covered" >      var keyCode = modifiedKeyCode(event);</span>
<span class="cstat-no" title="statement not covered" >      if (keyPressedCallbacks[keyCode]) {</span>
<span class="cstat-no" title="statement not covered" >        broadcastKey(keyCode);</span>
      }
    };
&nbsp;
    var repeater = '';
&nbsp;
    this.keyup = function (event) {
      <span class="missing-if-branch" title="if path not taken" >I</span>if (arethusaUtil.isIncluded(forbiddenTags, event.target.tagName)) {
<span class="cstat-no" title="statement not covered" >        return;</span>
      }
      if (isRepeater(event.keyCode)) {
        var rep = event.keyCode - 48;
        // A number needs to be broadcasted here, as it doesn't have a keydown
        // event at all.
        broadcastKey(rep);
        repeater = repeater + rep;
        return;
      }
      handleCallbacks(event);
      resetRepeater();
    };
&nbsp;
    this.doRepeated = function(fn) {
      var rep = parseInt(repeater, 10) || 1; // default value (and beware octals!)
      for (; rep &gt; 0; rep--) {
        fn();
      }
    };
&nbsp;
    function isRepeater(code) {
      <span class="missing-if-branch" title="else path not taken" >E</span>if (! isNaN(code)) {
        var numeric = parseInt(code) - 48;
        return numeric &gt; -1 &amp;&amp; numeric &lt; 10;
      }
    }
&nbsp;
    function resetRepeater() {
      repeater = '';
    }
&nbsp;
    function Callback(callback, priority) {
      this.callback = callback;
      this.priority = priority || 0;
    }
&nbsp;
    // The keyList is just a dictionary of string representations
    // of the keyCode we use internally.
    var keyList = {};
    function addToKeyList(code, key) {
      keyList[code] = key;
    }
&nbsp;
    /**
     * @ngdoc function
     * @name arethusa.core.keyCapture#onKeyPressed
     * @methodOf arethusa.core.keyCapture
     *
     * @description
     * TODO
     */
    this.onKeyPressed = function(key, callback, priority) {
      var keyCode = self.getKeyCode(key);
      addToKeyList(keyCode, key);
      var callbacks = keyPressedCallbacks[keyCode] || [];
      var cb = new Callback(callback, priority);
      callbacks.push(cb);
      keyPressedCallbacks[keyCode] = sortedByPriority(callbacks);
      return <span class="fstat-no" title="function not covered" >function() {</span> <span class="cstat-no" title="statement not covered" >removeElement(keyPressedCallbacks[keyCode], cb); </span>};
    };
&nbsp;
    function sortedByPriority(callbacks) {
      return callbacks.sort(function(a, b) {
        return b.priority - a.priority;
      });
    }
&nbsp;
    var propagationStopped = false;
&nbsp;
    /**
     * @ngdoc function
     * @name arethusa.core.keyCapture#stopPropagation
     * @methodOf arethusa.core.keyCapture
     *
     * @description
     * TODO
     */
    this.stopPropagation = <span class="fstat-no" title="function not covered" >function() {</span>
<span class="cstat-no" title="statement not covered" >      propagationStopped = true;</span>
    };
&nbsp;
    function resumePropagation() {
      propagationStopped = false;
    }
&nbsp;
    function resolveCallbacks(callbacks, event) {
      angular.forEach(callbacks, function(callbackObj, key) {
        <span class="missing-if-branch" title="else path not taken" >E</span>if (! propagationStopped) {
          callbackObj.callback(event);
        }
      });
    }
&nbsp;
    function Capture(confKey, fn, defaultKey) {
      this.confKey = confKey;
      this.fn = fn;
      this.defaultKey = defaultKey;
    }
&nbsp;
    this.create = function(confKey, fn, defaultKey) {
      return new Capture(confKey, fn, defaultKey);
    };
&nbsp;
    function addToKeys(keys, sec, name, key) {
      if (!keys[sec]) keys[sec] = {};
      keys[sec][name] = key;
    }
&nbsp;
    function addToKeyLists(keys) {
      var destructors = [];
      angular.extend(self.activeKeys, keys);
      angular.forEach(keys, function(captures, section) {
        angular.forEach(captures, function(key, capture) {
          var keysDefined = self.keyList[key];
          <span class="missing-if-branch" title="else path not taken" >E</span>if (!keysDefined) keysDefined = self.keyList[key] = [];
          var listKey = section + '.' + capture;
          keysDefined.push(listKey);
          destructors.push(<span class="fstat-no" title="function not covered" >function() {</span>
            // only remove when these elements haven't been redefined by someone
            // else
<span class="cstat-no" title="statement not covered" >            var sec = self.activeKeys[section] || {};</span>
<span class="cstat-no" title="statement not covered" >            var k   = sec[capture];</span>
<span class="cstat-no" title="statement not covered" >            if (key === k) <span class="cstat-no" title="statement not covered" >delete sec[capture];</span></span>
<span class="cstat-no" title="statement not covered" >            removeElement(keysDefined, listKey);</span>
          });
        });
      });
&nbsp;
      return destructorFn(destructors);
    }
&nbsp;
    function destructorFn(arr) {
      return <span class="fstat-no" title="function not covered" >function() {</span>
<span class="cstat-no" title="statement not covered" >        for (var i = arr.length - 1; i &gt;= 0; i--) { <span class="cstat-no" title="statement not covered" >arr[i](); </span>}</span>
      };
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function removeElement(arr, el) {</span>
<span class="cstat-no" title="statement not covered" >      var i = arr.indexOf(el);</span>
<span class="cstat-no" title="statement not covered" >      arr.splice(i, 1);</span>
    }
&nbsp;
    /**
     * @ngdoc function
     * @name arethusa.core.keyCapture#initCaptures
     * @methodOf arethusa.core.keyCapture
     *
     * @description
     * TODO
     */
    this.initCaptures = function(callback) {
      var destructors = [];
      var keys = arethusaUtil.inject({}, callback(self), function(memo, section, captures) {
        var conf = self.conf(section);
        angular.forEach(captures, function(capture, i) {
          var key = conf[capture.confKey] || capture.defaultKey;
          <span class="missing-if-branch" title="else path not taken" >E</span>if (angular.isDefined(key)) {
            addToKeys(memo, section, capture.confKey, key);
            var destructor = self.onKeyPressed(key, <span class="fstat-no" title="function not covered" >function() {</span>
<span class="cstat-no" title="statement not covered" >              $rootScope.$apply(capture.fn);</span>
            });
            destructors.push(destructor);
          }
        });
      });
&nbsp;
      <span class="missing-if-branch" title="else path not taken" >E</span>if (!angular.equals({}, keys)) {
        $rootScope.$broadcast('keysAdded', keys);
        destructors.push(addToKeyLists(keys));
      }
      keys.$destroy = destructorFn(destructors);
      return keys;
    };
&nbsp;
    // Help
<span class="fstat-no" title="function not covered" >    function usKeyboardLayout() {</span>
<span class="cstat-no" title="statement not covered" >      var layout = self.conf("keys");</span>
<span class="cstat-no" title="statement not covered" >      return layout.us;</span>
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function setStyle(kKey, cas) {</span>
      // 0 and 1 as properties of kKey.style.class may seem cryptic:
      // ng-repeat in the foreign-keys-help-template iterates
      // over the kKey.show array and provides class names with the
      // $index value. The first element is always the lower case
      // char, the second one the upper case char. This function
      // handles cases, where we want to set either the lower
      // case or the upper case key inactive.
&nbsp;
<span class="cstat-no" title="statement not covered" >      var style = kKey.style;</span>
<span class="cstat-no" title="statement not covered" >      var number = { "lower" : "0", "upper" : "1"};</span>
<span class="cstat-no" title="statement not covered" >      style.class = style.class || {};</span>
<span class="cstat-no" title="statement not covered" >      if (kKey.hide === undefined) {</span>
<span class="cstat-no" title="statement not covered" >        style.class[number[cas]] = "inactive";</span>
      }
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function pushKeys(fKeys, kKey, cas) {</span>
<span class="cstat-no" title="statement not covered" >      var display = kKey.show;</span>
<span class="cstat-no" title="statement not covered" >      var typeCase = kKey[cas];</span>
<span class="cstat-no" title="statement not covered" >      if (!typeCase) <span class="cstat-no" title="statement not covered" >return;</span></span>
&nbsp;
<span class="cstat-no" title="statement not covered" >      if (fKeys[typeCase]) {</span>
<span class="cstat-no" title="statement not covered" >        display.push(fKeys[typeCase]);</span>
      } else {
<span class="cstat-no" title="statement not covered" >        setStyle(kKey, cas);</span>
<span class="cstat-no" title="statement not covered" >        display.push(typeCase);</span>
      }
    }
&nbsp;
    this.mappedKeyboard = <span class="fstat-no" title="function not covered" >function(language, shifted) {</span>
<span class="cstat-no" title="statement not covered" >      var fKeys = keysFor(language);</span>
<span class="cstat-no" title="statement not covered" >      var keyboardKeys = usKeyboardLayout();</span>
<span class="cstat-no" title="statement not covered" >      var res = [];</span>
<span class="cstat-no" title="statement not covered" >      var modes = ['lower', 'upper'];</span>
<span class="cstat-no" title="statement not covered" >      modes = shifted ? modes.reverse() : modes;</span>
<span class="cstat-no" title="statement not covered" >      angular.forEach(keyboardKeys, <span class="fstat-no" title="function not covered" >function(kKey, i) {</span></span>
<span class="cstat-no" title="statement not covered" >        kKey.show = [];</span>
<span class="cstat-no" title="statement not covered" >        angular.forEach(modes, <span class="fstat-no" title="function not covered" >function(mode, i) {</span></span>
<span class="cstat-no" title="statement not covered" >          pushKeys(fKeys, kKey, mode);</span>
        });
<span class="cstat-no" title="statement not covered" >        res.push(kKey);</span>
      });
<span class="cstat-no" title="statement not covered" >      return res;</span>
    };
&nbsp;
    /**
     * @ngdoc property
     * @name activeKeys
     * @propertyOf arethusa.core.keyCapture
     *
     * @description
     * TODO
     */
    this.activeKeys = {};
&nbsp;
    /**
     * @ngdoc property
     * @name keyList
     * @propertyOf arethusa.core.keyCapture
     *
     * @description
     * TODO
     */
    this.keyList = {};
  }
]);
&nbsp;</pre></td></tr>
</table></pre>

</div>
<div class="footer">
    <div class="meta">Generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Tue May 12 2015 11:20:41 GMT+0200 (CEST)</div>
</div>

<script src="../../prettify.js"></script>

<script src="https://yui-s.yahooapis.com/3.6.0/build/yui/yui-min.js"></script>
<script>

    YUI().use('datatable', function (Y) {

        var formatters = {
          pct: function (o) {
              o.className += o.record.get('classes')[o.column.key];
              try {
                  return o.value.toFixed(2) + '%';
              } catch (ex) { return o.value + '%'; }
          },
          html: function (o) {
              o.className += o.record.get('classes')[o.column.key];
              return o.record.get(o.column.key + '_html');
          }
        },
          defaultFormatter = function (o) {
              o.className += o.record.get('classes')[o.column.key];
              return o.value;
          };

        function getColumns(theadNode) {
            var colNodes = theadNode.all('tr th'),
                cols = [],
                col;
            colNodes.each(function (colNode) {
                col = {
                    key: colNode.getAttribute('data-col'),
                    label: colNode.get('innerHTML') || ' ',
                    sortable: !colNode.getAttribute('data-nosort'),
                    className: colNode.getAttribute('class'),
                    type: colNode.getAttribute('data-type'),
                    allowHTML: colNode.getAttribute('data-html') === 'true' || colNode.getAttribute('data-fmt') === 'html'
                };
                col.formatter = formatters[colNode.getAttribute('data-fmt')] || defaultFormatter;
                cols.push(col);
            });
            return cols;
        }

        function getRowData(trNode, cols) {
            var tdNodes = trNode.all('td'),
                    i,
                    row = { classes: {} },
                    node,
                    name;
            for (i = 0; i < cols.length; i += 1) {
                name = cols[i].key;
                node = tdNodes.item(i);
                row[name] = node.getAttribute('data-value') || node.get('innerHTML');
                row[name + '_html'] = node.get('innerHTML');
                row.classes[name] = node.getAttribute('class');
                //Y.log('Name: ' + name + '; Value: ' + row[name]);
                if (cols[i].type === 'number') { row[name] = row[name] * 1; }
            }
            //Y.log(row);
            return row;
        }

        function getData(tbodyNode, cols) {
            var data = [];
            tbodyNode.all('tr').each(function (trNode) {
                data.push(getRowData(trNode, cols));
            });
            return data;
        }

        function replaceTable(node) {
            if (!node) { return; }
            var cols = getColumns(node.one('thead')),
                data = getData(node.one('tbody'), cols),
                table,
                parent = node.get('parentNode');

            table = new Y.DataTable({
                columns: cols,
                data: data,
                sortBy: 'file'
            });
            parent.set('innerHTML', '');
            table.render(parent);
        }

        Y.on('domready', function () {
            replaceTable(Y.one('div.coverage-summary table'));
            if (typeof prettyPrint === 'function') {
                prettyPrint();
            }
        });
    });
</script>
</body>
</html>
